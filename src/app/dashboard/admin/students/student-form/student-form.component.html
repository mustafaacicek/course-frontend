<form [formGroup]="studentForm" (ngSubmit)="onSubmit()" class="student-form">
  <div class="alert alert-danger" *ngIf="error">
    <div class="notification-content">
      <i class="fas fa-exclamation-circle"></i>
      <span>{{ error }}</span>
    </div>
    <button type="button" class="close-button" (click)="error = null">
      <i class="fas fa-times"></i>
    </button>
  </div>
  
  <div class="validation-summary" *ngIf="Object.keys(validationErrors).length > 0">
    <ul>
      <li *ngFor="let error of Object.entries(validationErrors)">
        <strong>{{ error[0] }}</strong>: {{ error[1] }}
      </li>
    </ul>
  </div>
  
  <div class="form-section">

  <div class="form-row">
    <div class="form-group">
      <label for="nationalId">TC Kimlik No <span class="required">*</span></label>
      <input 
        type="text" 
        id="nationalId" 
        formControlName="nationalId"
        [class.is-invalid]="hasError('nationalId')"
        maxlength="11"
        placeholder="12345678901"
      >
      <div class="error-message" *ngIf="hasError('nationalId')">
        {{ getErrorMessage('nationalId') }}
      </div>
    </div>
  </div>

  <div class="form-row">
    <div class="form-group">
      <label for="firstName">Ad <span class="required">*</span></label>
      <input 
        type="text" 
        id="firstName" 
        formControlName="firstName"
        [class.is-invalid]="hasError('firstName')"
        maxlength="50"
      >
      <div class="error-message" *ngIf="hasError('firstName')">
        {{ getErrorMessage('firstName') }}
      </div>
    </div>

    <div class="form-group">
      <label for="lastName">Soyad <span class="required">*</span></label>
      <input 
        type="text" 
        id="lastName" 
        formControlName="lastName"
        [class.is-invalid]="hasError('lastName')"
        maxlength="50"
      >
      <div class="error-message" *ngIf="hasError('lastName')">
        {{ getErrorMessage('lastName') }}
      </div>
    </div>
  </div>

  <div class="form-row">
    <div class="form-group">
      <label for="motherName">Anne Adı</label>
      <input 
        type="text" 
        id="motherName" 
        formControlName="motherName"
        [class.is-invalid]="hasError('motherName')"
        maxlength="50"
      >
      <div class="error-message" *ngIf="hasError('motherName')">
        {{ getErrorMessage('motherName') }}
      </div>
    </div>

    <div class="form-group">
      <label for="fatherName">Baba Adı</label>
      <input 
        type="text" 
        id="fatherName" 
        formControlName="fatherName"
        [class.is-invalid]="hasError('fatherName')"
        maxlength="50"
      >
      <div class="error-message" *ngIf="hasError('fatherName')">
        {{ getErrorMessage('fatherName') }}
      </div>
    </div>
  </div>

  <div class="form-row">
    <div class="form-group">
      <label for="phone">Telefon</label>
      <input 
        type="text" 
        id="phone" 
        formControlName="phone"
        placeholder="5XX XXX XX XX"
        [class.is-invalid]="hasError('phone')"
        maxlength="11"
      >
      <div class="error-message" *ngIf="hasError('phone')">
        {{ getErrorMessage('phone') }}
      </div>
    </div>

    <div class="form-group">
      <label for="birthDate">Doğum Tarihi</label>
      <input 
        type="date" 
        id="birthDate" 
        formControlName="birthDate"
        [class.is-invalid]="hasError('birthDate')"
      >
      <div class="error-message" *ngIf="hasError('birthDate')">
        {{ getErrorMessage('birthDate') }}
      </div>
    </div>
  </div>

  <div class="form-group full-width">
    <label for="address">Adres</label>
    <textarea 
      id="address" 
      formControlName="address"
      rows="3"
      [class.is-invalid]="hasError('address')"
      maxlength="255"
    ></textarea>
    <div class="error-message" *ngIf="hasError('address')">
      {{ getErrorMessage('address') }}
    </div>
  </div>

  <div class="form-row">
    <div class="form-group">
      <label for="locationId">Lokasyon <span class="required">*</span></label>
      <div class="location-selection-container" *ngIf="!isLoadingLocations; else loadingLocations">
        <select 
          id="locationId" 
          formControlName="locationId"
          class="location-select"
          [class.is-invalid]="hasError('locationId')"
        >
          <option [ngValue]="null">Lokasyon seçiniz</option>
          <option *ngFor="let location of courseLocations" [ngValue]="location.id">
            {{ location.name }} ({{ location.address }})
          </option>
        </select>
        <div class="error-message" *ngIf="hasError('locationId')">
          {{ getErrorMessage('locationId') }}
        </div>
        <div class="location-info" *ngIf="studentForm.get('locationId')?.value">
          <p class="info-text">
            <i class="fas fa-info-circle"></i>
            Öğrenci seçilen lokasyona atanacaktır.
          </p>
        </div>
      </div>
      <ng-template #loadingLocations>
        <div class="loading-locations">
          <i class="fas fa-spinner fa-spin"></i> Lokasyonlar yükleniyor...
        </div>
      </ng-template>
    </div>
  </div>

  </div>
  
  <div class="form-actions">
    <button type="submit" class="submit-button" [disabled]="isSubmitting || studentForm.invalid">
      <i class="fas fa-spinner fa-spin" *ngIf="isSubmitting"></i>
      <i class="fas fa-save" *ngIf="!isSubmitting"></i>
      <span>{{ student ? 'Güncelle' : 'Kaydet' }}</span>
    </button>
    <button type="button" class="cancel-button" (click)="onCancel()">
      <i class="fas fa-times"></i>
      <span>İptal</span>
    </button>
  </div>
</form>
